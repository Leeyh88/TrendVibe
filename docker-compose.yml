services:
  # 1. Nginx ì›¹ ì„œë²„ (Reverse Proxy ì—­í• )
  web:
    image: nginx:stable-alpine
    container_name: web-server
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www/html
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - app
      - frontend

  # 2. PHP-FPM (Laravel ë°±ì—”ë“œ ì‹¤í–‰)
  app:
    build:
      context: .
      dockerfile: Dockerfile.app
    container_name: laravel-app
    volumes:
      - ./src:/var/www/html
    environment:
      DB_HOST: mariadb
      DB_DATABASE: tm_db
      DB_USERNAME: tm_user
      DB_PASSWORD: tm_password

  # 3. MariaDB ë°ì´í„°ë² ì´ìŠ¤ (í•˜ë‚˜ë§Œ ë‚¨ê¹€)
  mariadb:
    image: mariadb:10.6
    ports:
    - "3306:3306" # <-- ì´ ì„¤ì •ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•©ë‹ˆë‹¤!
    container_name: mariadb-db
    environment:
      MYSQL_DATABASE: tm_db
      MYSQL_USER: tm_user
      MYSQL_PASSWORD: tm_password
      MYSQL_ROOT_PASSWORD: root_tm_password # ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸ëŠ” ì¤‘ìš”!
    volumes:
      - mariadb_data:/var/lib/mysql

  # 4. Node.js (Vue.js ê°œë°œ ì„œë²„)
  frontend:
    image: node:22-alpine
    container_name: vue-frontend
    working_dir: /app
    # ğŸ’¡ Vue ì†ŒìŠ¤ ì½”ë“œê°€ 'frontend' í´ë”ì— ìˆë‹¤ë©´ ì£¼ì„ì„ í•´ì œí•´ì•¼ í•©ë‹ˆë‹¤.
    # - ./frontend:/app 
    volumes:
      - ./frontend:/app:delegated # â­ ./src/frontendë¡œ ìˆ˜ì • (ì´ì „ì˜ ì£¼ì„ í•´ì œ ë° ê²½ë¡œ ìˆ˜ì •)
    # command: npm run dev
    command: tail -f /dev/null
    ports:
      - "5173:5173"

volumes:
  mariadb_data:
    driver: local
